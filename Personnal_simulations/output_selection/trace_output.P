primitive(attackerLocated,1).
primitive(vulExists,3).
primitive(hostDom,2).
derived(mitm,1).
derived(admin,1).
derived(dcSync,1).
derived(vulnerableHost,1).
derived(classicQCM,1).
derived(validCredentials,1).
derived(lowAccess,1).
derived(passTheTicket,1).
meta(attackGoal,1).
meta(cvss,2).

attack(admin(domain)).

possible_duplicate_trace_step(because(6,rule_desc('valid credentials may be found',likely),validCredentials(domain),[attackerLocated(domain)])).

possible_duplicate_trace_step(because(0,rule_desc('mitm attack is possible',likely),mitm(domain),[cvss('CVE-2022-26925',h),vulExists(domain,'CVE-2022-26925',smb),attackerLocated(domain)])).

possible_duplicate_trace_step(because(2,rule_desc('dc sync attack is possible',likely),dcSync(domain),[cvss('CVE-2019-1040',h),vulExists(domain,'CVE-2019-1040',dcSync),mitm(domain)])).

possible_duplicate_trace_step(because(2,rule_desc('dc sync attack is possible',likely),dcSync(domain),[cvss('CVE-2020-1472',h),vulExists(domain,'CVE-2020-1472',dcSync),mitm(domain)])).

possible_duplicate_trace_step(because(2,rule_desc('dc sync attack is possible',likely),dcSync(domain),[cvss('CVE-2020-1472',h),vulExists(domain,'CVE-2020-1472',dcSync),mitm(domain)])).

possible_duplicate_trace_step(because(6,rule_desc('valid credentials may be found',likely),validCredentials(domain),[attackerLocated(domain)])).

possible_duplicate_trace_step(because(7,rule_desc('domain admin access is possible',likely),passTheTicket(domain),[cvss('CVE-2021-42287',h),vulExists(domain,'CVE-2021-42287',cred_to_ticket),validCredentials(domain)])).

possible_duplicate_trace_step(because(12,rule_desc('ECS8 from http to pass the ticket',likely),passTheTicket(domain),[vulExists(domain,'CVE-0000-3',adcs),mitm(domain)])).

possible_duplicate_trace_step(because(11,rule_desc('lateral move to dcsync',likely),dcSync(domain),[vulExists(domain,'CVE-0000-2',passTicket_to_dcsync),passTheTicket(domain)])).

possible_duplicate_trace_step(because(11,rule_desc('lateral move to dcsync',likely),dcSync(domain),[vulExists(domain,'CVE-0000-2',passTicket_to_dcsync),passTheTicket(domain)])).

possible_duplicate_trace_step(because(10,rule_desc('dc Sync',likely),admin(domain),[vulExists(domain,'CVE-0000-1',dcSync_to_domadmin),dcSync(domain)])).

possible_duplicate_trace_step(because(10,rule_desc('dc Sync',likely),admin(domain),[vulExists(domain,'CVE-0000-1',dcSync_to_domadmin),dcSync(domain)])).

attack(admin(domain)).

attack(admin(domain)).

attack(admin(domain)).

attack(admin(domain)).

attack(admin(host)).

possible_duplicate_trace_step(because(8,rule_desc('admin access is possible',likely),admin(host),[cvss('CVE-2019-0724',h),vulExists(host,'CVE-2019-0724',cred_to_admin),hostDom(host,domain),validCredentials(domain)])).

possible_duplicate_trace_step(because(5,rule_desc('low access is possible',likely),lowAccess(host),[cvss('CVE-2021-44228',h),vulExists(host,'CVE-2021-44228',vulnerableHost),attackerLocated(domain)])).

possible_duplicate_trace_step(because(9,rule_desc('privilege escalation',likely),admin(host),[cvss('CVE-2020-0796',h),vulExists(host,'CVE-2020-0796',low_to_admin),lowAccess(host)])).

attack(admin(host)).

